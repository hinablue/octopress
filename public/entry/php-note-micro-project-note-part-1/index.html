
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>[PHP note.] 微型專案 Part 1 - HINA::工程幼稚園</title>
  <meta name="author" content="hinablue">

  
  <meta name="description" content="這是技術外加嘴砲文。 專案就是這樣，從許多大中小型的 Framework 挑一個適合的來用，萬一沒有中意的，那只好-複製貼上-自己刻一個比較快。當然，不是什麼時候都可以重造輪子的，案子很急很趕-屎都在門邊-的時候，挑幾個小型的 Framework 快速上手應該是比較好的解法。 那我寫這個幹麼（ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.hinablue.me/entry/php-note-micro-project-note-part-1">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/hinablue" rel="alternate" title="HINA::工程幼稚園" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-259895-17']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">HINA::工程幼稚園</a></h1>
  
    <h2>偏執與強迫症的患者，算不上是無可救藥，只是我已經遇上我的良醫了。</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/hinablue" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.hinablue.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">[PHP Note.] 微型專案 Part 1</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-20T23:38:00+08:00" pubdate data-updated="true">Nov 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>這是技術外加嘴砲文。</p>

<p>專案就是這樣，從許多大中小型的 Framework 挑一個適合的來用，萬一沒有中意的，那只好-複製貼上-自己刻一個比較快。當然，不是什麼時候都可以重造輪子的，案子很急很趕-屎都在門邊-的時候，挑幾個小型的 Framework 快速上手應該是比較好的解法。</p>

<p>那我寫這個幹麼（被揍飛！</p>

<h3>需求認知</h3>

<p>快速開發，又得要考慮多人同時進行，版本控制就很重要，git 當然是不二選擇。除了 git 我想不到其他的辦法，沒辦法，誰叫 git 這麼好用呢。版本控制確定了，那麼就得決定專案需求的方向。各大類型的 Framework 總是免不了一大堆的設定、Controllers、Modules、Views、Plugins 等等，當我不需要得時候，是不是能有一個檔案搞定的解法呢？</p>

<p>又，資料庫怎麼辦？在 gitHub 上面不乏有許多小型的資料庫工具可用，像是以 <a href="http://deep.tw/" target="_blank">@pct</a> 的 <a href="https://github.com/pct/4money" target="_blank">4money</a> 專案所使用的 <a href="https://github.com/j4mie/idiorm" target="_blank">idiorm</a> 就是一個不錯的工具。-當然，如果你想自己用 PDO 來刻也是可以的-。</p>

<!-- more -->


<p>那，Views 怎麼辦呢？用 Smarty 嗎？還是？</p>

<h3>確認需求</h3>

<p>所以，我決定這麼做：<ul><li>自己刻一個簡易的 Bootstrap，然後可以使用 Controllers, Plugins, Modules 等等。</li><li>資料庫使用 idiorm。
</li><li>Views 直接使用 PHP（其實 PHP 本身就是樣板引擎）。</li></ul>我要做一個 RESTful 的 API 介面，其實用不太到 Views 的功能，所以才會選擇用 PHP 自己刻。那麼，Bootstrap 該怎麼開始比較好？</p>

<h3>自己刻，比較快？</h3>

<p>真的嗎？</p>

<p>首先，我知道 RESTful 的 API 需要回傳 HTTP 狀態碼，然後要將 body 填入回傳的資訊。我們有兩種方法，一種是 JSON，另一種是 XML，所以我們就會有兩種回傳資訊的功能。</p>

<p>HTTP 狀態碼則可以用 header() 來送，簡單明瞭（喂</p>

<figure class='code'><figcaption><span>A simple header()</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>  <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;HTTP/1.0 400 BAD REQUEST&#39;</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>那麼，Bootstrap 還是沒有解決啊？</p>

<figure class='code'><figcaption><span>bootstrap.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Controller</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Container</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">startup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 開始跑</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Container</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">startup</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>那我們的 Controllers 呢？舉一個簡單的例子，我們開一個目錄叫做 controllers，然後裡面放了個 Api.php 這樣。</p>

<figure class='code'><figcaption><span>controllers/Api.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Api</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">startup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 開始跑</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>然後訪問 index.php 的時候，發現 Api.php 並不會動，那一定是有什麼-奇怪的東西混進來了-寫錯了。所以我們再來看一下 index.php 是不是有漏掉的地方。</p>

<figure class='code'><figcaption><span>bootstrap.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Controller</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Container</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">private</span> <span class="nv">$controller</span><span class="p">;</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">startup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 開始跑</span>
</span><span class='line'>          <span class="k">require_once</span> <span class="s1">&#39;controllers/Api.php&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Api</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">startup</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Container</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">startup</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>疑？那最近每一套 Framework 都很夯的 Routing 功能，或是去除掉 index.php 的動作要怎麼做呢？當然，如果你有用過 Rewrite Engine 的話，這個問題應該很快就能夠解決。要怎麼把網址拆開來，依照 Controller/Method/Value1/Value2 來傳遞到你的 Controller 裡面，這就是請自己努力的地方了。而其實，你也可以參考各大 Framework 的作法，也是可以學到一點東西的。</p>

<p>所以，我把網址所傳入的東西依照 Controller/Method/Value1/Value2 拆開來了，那麼，我們的 Container 就可以這樣改寫：</p>

<figure class='code'><figcaption><span>bootstrap.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Container</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">private</span> <span class="nv">$controller</span><span class="p">;</span>
</span><span class='line'>      <span class="k">private</span> <span class="nv">$segments</span><span class="p">;</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">startup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 開始跑</span>
</span><span class='line'>          <span class="c1">// 做了一狗票的事情，把網址轉成下列格式，存入 segments 中。</span>
</span><span class='line'>          <span class="c1">// Controller/Method/Value1/Value2</span>
</span><span class='line'>          <span class="c1">// 所以我們就把 Controller 提出來</span>
</span><span class='line'>          <span class="nv">$controllerName</span> <span class="o">=</span> <span class="nx">ucfirst</span><span class="p">(</span><span class="nx">strtolower</span><span class="p">(</span><span class="nb">array_shift</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">segments</span><span class="p">)));</span>
</span><span class='line'>          <span class="nv">$controllerPath</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPArATOR</span> <span class="o">.</span> <span class="s1">&#39;controllers&#39;</span><span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span> <span class="o">.</span> <span class="nv">$controllerName</span> <span class="o">.</span> <span class="s1">&#39;.php&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$controllerPath</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">require_once</span> <span class="nv">$controllerPath</span><span class="p">;</span>
</span><span class='line'>              <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$controllerName</span><span class="p">;</span>
</span><span class='line'>              <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">startup</span><span class="p">();</span>
</span><span class='line'>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Controller does not exists.&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>方法呼叫也是一樣，繼續改寫 Container 的部份：</p>

<figure class='code'><figcaption><span>bootstrap.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$controllerPath</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">require_once</span> <span class="nv">$controllerPath</span><span class="p">;</span>
</span><span class='line'>              <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$controllerName</span><span class="p">;</span>
</span><span class='line'>              <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">startup</span><span class="p">();</span>
</span><span class='line'>              <span class="nv">$methodName</span> <span class="o">=</span> <span class="nx">ucfirst</span><span class="p">(</span><span class="nx">strtolower</span><span class="p">(</span><span class="nb">array_shift</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">segments</span><span class="p">)));</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">,</span> <span class="nv">$methodName</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="nv">$methodName</span><span class="p">();</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                  <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="nx">s</span> <span class="nx">method</span> <span class="nx">does</span> <span class="k">not</span> <span class="nx">exists</span><span class="o">.</span><span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">             }</span>
</span><span class='line'><span class="s1">         } else {</span>
</span><span class='line'><span class="s1">             die(&#39;</span><span class="nx">Controller</span> <span class="nx">does</span> <span class="k">not</span> <span class="nx">exists</span><span class="o">.</span><span class="err">&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>傳值呢？我們有好多好多的值要傳，怎麼傳？在 PHP 中有一個方法，叫做 <a href="http://php.net/manual/en/function.call-user-func-array.php" target="_blank"><code>call_user_func_array</code></a>，使用的方式也很簡單，我們看 code 比較快：</p>

<figure class='code'><figcaption><span>bootstrap.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">,</span> <span class="nv">$methodName</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                  <span class="c1">// 原本的呼叫方式我們不要用了</span>
</span><span class='line'>                  <span class="c1">// $this-&gt;controller-&gt;$methodName();</span>
</span><span class='line'>                  <span class="nb">call_user_func_array</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">,</span> <span class="nv">$methodName</span><span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">segments</span> <span class="p">);</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                  <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="nx">s</span> <span class="nx">method</span> <span class="nx">does</span> <span class="k">not</span> <span class="nx">exists</span><span class="o">.</span><span class="err">&#39;</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>那，如果我要回傳呢？我們在這裡用 JSON 回傳的方式來舉例說明。我們寫一個靜態方法在 Controller 裡面，用靜態的方式來呼叫就好了。</p>

<figure class='code'><figcaption><span>bootstrap.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Controller</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">responseJSON</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">header</span><span class="p">(</span><span class="s2">&quot;pragma: no-cache&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">header</span><span class="p">(</span><span class="s2">&quot;cache-control: no-store, no-cache, max-age=0, must-revalidate&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">header</span><span class="p">(</span><span class="s2">&quot;content-type: text/x-json; charset=utf-8&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">header</span><span class="p">(</span><span class="s2">&quot;X-JSON: &quot;</span><span class="o">.</span> <span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>                <span class="k">echo</span> <span class="nv">$data</span><span class="p">;</span>
</span><span class='line'>                <span class="k">exit</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;JSON object invalid.&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;JSON object invalid.&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// ... 後面省略一萬行</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>你可以這麼做：</p>

<figure class='code'><figcaption><span>controllers/Api.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Api</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">startup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// 開始跑</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">ThereIsTheTest</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// 這裡省略一萬行</span>
</span><span class='line'>        <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;value&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;There is the test&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">Controller</span><span class="o">::</span><span class="na">responseJSON</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>是的，這樣一個簡易的 Bootstrap 就完成了。</p>

<h3>錯誤控制</h3>

<p>上面看到不少 die()，寫太多的話你以後要除錯真的會 DIE！不過這個下次再談（疑）。</p>

<h3>資料控制</h3>

<p>idiorm 我們下次見（喂喂）。</p>

<h3>小結</h3>

<p>以入門者來說，要寫一個簡易的控制器並不是難事，你看<strong>像我這種弱雞</strong>都寫得出類似 RESTful API 的東西了，可見這並非太過於困難。-只要有心，人人都可以自己刻-。程式碼的部份無法交代太多，不過，已經有一個專案是以這種類似模式在開發，然後最近要正式上線測試了。</p>

<p>所以說，在程式上還是有很多眉眉角角是必須要去注意的。就像是你永遠沒辦法預防使用者在 ajax 的時候，按下 ESC 或是 F5 鍵一樣（這在瀏覽器動作上，是有可能中斷 ajax 傳輸的操作）。</p>

<p>這是一個很入門的輪子，就像是 @pct 說得，<strong>如果沒有辦法改變世界，那最起碼改變自己的人生</strong>。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">hinablue</span></span>

      








  


<time datetime="2011-11-20T23:38:00+08:00" pubdate data-updated="true">Nov 20<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/categories/php/'>PHP</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blog.hinablue.me/entry/php-note-micro-project-note-part-1/" data-via="hinablue" data-counturl="http://blog.hinablue.me/entry/php-note-micro-project-note-part-1/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/entry/photos-birthday-Bellini-pasta-pasta-2011-11-11/" title="Previous Post: [生日慶大餐] Bellini pasta pasta">&laquo; [生日慶大餐] Bellini pasta pasta</a>
      
      
        <a class="basic-alignment right" href="/entry/photos-2011-11-nantou-part-1/" title="next Post: [影像] 溪頭，忘憂之旅 Part 1">[影像] 溪頭，忘憂之旅 Part 1 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <img src="/images/hniablue_icon.jpg" width="195" height="195" alt="Hina, Cain Chen." />
  <p>我是閃光洽！</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
  </ul>
</section>
<script type="text/javascript">
    $.domReady(function() {
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }
        (function() {
            $.ajax({
                url: '/atom.xml',
                dataType: 'xml',
                success: function(xml) {
                    var parser, expectedXML;
                    if (window.DOMParser) {
                        parser = new DOMParser();
                        expectedXML = parser.parseFromString(decodeURIComponent(xml.response),"text/xml");
                    } else {
                        expectedXML = new ActiveXObject("Microsoft.XMLDOM");
                        expectedXML.async = false;
                        expectedXML.loadXML(decodeURIComponent(xml.response));
                    }

                    var entries = expectedXML.getElementsByTagName('entry');
                    var entries_limit = entries.length > 5 ? 5 : entries.length;
                    for(var i=0; i<entries_limit; i++) {
                        $('<a/>')
                        .attr('href', entries[i].childNodes[3].attributes[0].nodeValue)
                        .text(entries[i].childNodes[1].childNodes[0].nodeValue)
                        .appendTo($('<li/>').addClass('post').appendTo($('#recent_posts')));
                    }
                },
                error: function(err) {
                    $('<li/>').addClass('post').text('Error Loading feed').appendTo($('#recent_posts'));
                }
            });
        })();
    });
</script>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/hinablue">@hinablue</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'hinablue',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("hinablue", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/hinablue" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @hinablue</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/104812280860478253996?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - hinablue -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'hinablue';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.hinablue.me/entry/php-note-micro-project-note-part-1/';
        var disqus_url = 'http://blog.hinablue.me/entry/php-note-micro-project-note-part-1/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
